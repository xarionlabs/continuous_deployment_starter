services:
  pxy6_com:
    image: "ghcr.io/xarionlabs/continuous_deployment_starter/pxy6.com:${APP_VERSION}"
    restart: "no"
    environment:
      API_BASE_URL: https://${APP_PXY6_VIRTUAL_HOST}
      NODE_ENV: production
    volumes:
      - pxy6_static:/app/src/dist
    labels:
      - "io.containers.autoupdate=registry"

  pxy6_com_nginx:
    image: docker.io/library/nginx:alpine
    container_name: pxy6_com_nginx
    depends_on:
      - pxy6_com
    environment:
      VIRTUAL_HOST: ${PXY6_COM_VIRTUAL_HOST}
    volumes:
      - pxy6_static:/usr/share/nginx/html:ro
      - ./pxy6_web_nginx.conf:/etc/nginx/conf.d/nginx.conf:ro
    expose:
      - "80"
    networks:
      - proxy_network
    restart: unless-stopped

volumes:
  pxy6_static:
  nginx_config:

networks:
  proxy_network:
    driver: bridge